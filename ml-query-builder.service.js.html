<!doctype html>
<html>

<head>
  <meta name="generator" content="JSDoc 3.3.2">
  <meta charset="utf-8">
  <title>Source: ml-query-builder.service.js</title>
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Karla:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Noto+Serif:400,400i,700,700i" type="text/css">
  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Inconsolata:500" type="text/css">
  <link href="css/baseline.css" rel="stylesheet">
</head>

<body onload="prettyPrint()">
  <nav id="jsdoc-navbar" role="navigation" class="jsdoc-navbar">
    <div id="jsdoc-navbar-container">
      <div id="jsdoc-navbar-content">
        <a href="index.html" class="jsdoc-navbar-package-name">Home</a>
      </div>
    </div>
  </nav>
  <div id="jsdoc-body-container">
    <div id="jsdoc-content">
      <div id="jsdoc-content-container">
        <div id="jsdoc-banner" role="banner">
        </div>
        <div id="jsdoc-main" role="main">
          <header class="page-header">
            <h1>Source: ml-query-builder.service.js</h1>
          </header>
          <article>
            <pre class="prettyprint linenums"><code>(function() {
  &#x27;use strict&#x27;;

  angular.module(&#x27;ml.common&#x27;)
    .factory(&#x27;MLQueryBuilder&#x27;, MLQueryBuilder);

  /**
   * @class MLQueryBuilder
   * @classdesc angular service for building
   * {@link http://docs.marklogic.com/guide/search-dev/structured-query structured queries}
   *
   * Designed for one-way compatibility with a subset of the official
   * {@link http://developer.marklogic.com/features/node-client-api node-client-api}
   * {@link http://docs.marklogic.com/jsdoc/queryBuilder.html query-builder};
   * queries written to {@link MLQueryBuilder} (excluding deprecated methods)
   * should work with the offical API, but not necessarily vice-versa.
   *
   * Additionally includes extension methods (on {@link MLQueryBuilder.ext}),
   * supporting various constraint queries, operator state query components,
   * and combined queries.
   */
  function MLQueryBuilder() {

    function where() {
      var args = asArray.apply(null, arguments);
      return {
        &#x27;query&#x27;: {
          &#x27;queries&#x27;: args
        }
      };
    }

    return {

      /**
       * @method MLQueryBuilder#query
       * @see MLQueryBuilder#where
       * @deprecated
       */
      query: function() {
        console.log(
          &#x27;Warning, MLQueryBuilder.query is deprecated, and will be removed in the next release!\n&#x27; +
          &#x27;Use MLQueryBuilder.where in it\&#x27;s place&#x27;
        );
        return this.where.apply(this, arguments);
      },

      /**
       * @method MLQueryBuilder#text
       * @see MLQueryBuilder.ext.combined
       * @deprecated
       */
      text: function text(qtext) {
        console.log(
          &#x27;Warning, MLQueryBuilder.text is deprecated, and will be removed in the next release!\n&#x27; +
          &#x27;Use the qtext argument of MLQueryBuilder.ext.combined in it\&#x27;s place&#x27;
        );
        return {
          &#x27;qtext&#x27;: qtext
        };
      },

      /**
       * @method MLQueryBuilder#properties
       * @deprecated
       */
      properties: function properties(query) {
        console.log(
          &#x27;Warning, MLQueryBuilder.properties is deprecated, and will be removed in the next release!\n&#x27; +
          &#x27;Use MLQueryBuilder.propertiesFragment in it\&#x27;s place&#x27;
        );
        return this.propertiesFragment.apply(this, arguments);
      },

      /**
       * Creates a {@link http://docs.marklogic.com/guide/search-dev/structured-query structured query}
       * from a set of sub-queries
       * @method MLQueryBuilder#where
       * @see http://docs.marklogic.com/jsdoc/queryBuilder.html#where
       *
       * @param {...Object} queries - sub queries
       * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query structured query}
       */
      where: where,

      and: function and() {
        var args = asArray.apply(null, arguments);
        return {
          &#x27;and-query&#x27;: {
            &#x27;queries&#x27;: args
          }
        };
      },

      /**
       * Builds an {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_64259 &#x60;or-query&#x60;}
       * @method MLQueryBuilder#or
       * @see http://docs.marklogic.com/jsdoc/queryBuilder.html#or
       *
       * @param {...Object} queries - sub queries
       * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_64259 or-query}
       */
      or: function or() {
        var args = asArray.apply(null, arguments);
        return {
          &#x27;or-query&#x27;: {
            &#x27;queries&#x27;: args
          }
        };
      },

      /**
       * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_39488 &#x60;not-query&#x60;}
       * @method MLQueryBuilder#not
       * @see http://docs.marklogic.com/jsdoc/queryBuilder.html#not
       *
       * @param {Object} query - sub query to be negated
       * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_39488 not-query}
       */
      not: function properties(query) {
        return {
          &#x27;not-query&#x27;: query
        };
      },

      /**
       * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_30556 &#x60;document-fragment-query&#x60;}
       * @method MLQueryBuilder#documentFragment
       * @see http://docs.marklogic.com/jsdoc/queryBuilder.html#documentFragment
       *
       * @param {Object} query - sub query to be constrained to document fragments
       * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_30556 document-fragment-query}
       */
      documentFragment: function documentFragment(query) {
        return { &#x27;document-fragment-query&#x27;: query };
      },

      /**
       * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_67222 &#x60;properties-fragment-query&#x60;}
       * @method MLQueryBuilder#propertiesFragment
       * @see http://docs.marklogic.com/jsdoc/queryBuilder.html#propertiesFragment
       *
       * @param {Object} query - sub query to be constrained to properties fragments
       * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_67222 properties-fragment-query}
       */
      propertiesFragment: function propertiesFragment(query) {
        return { &#x27;properties-fragment-query&#x27;: query };
      },

      /**
       * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_53441 &#x60;locks-fragment-query&#x60;}
       * @method MLQueryBuilder#locksFragment
       * @see http://docs.marklogic.com/jsdoc/queryBuilder.html#locksFragment
       *
       * @param {Object} query - sub query to be constrained to document locks
       * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_53441 locks-fragment-query}
       */
      locksFragment: function locksFragment(query) {
        return { &#x27;locks-fragment-query&#x27;: query };
      },

      /**
       * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_94821 &#x60;directory-query&#x60;}
       * @method MLQueryBuilder#directory
       * @see http://docs.marklogic.com/jsdoc/queryBuilder.html#directory
       *
       * @param {...String|Array&amp;lt;String&gt;} uris - the directory URIs to query (logical OR)
       * @param {Boolean} [infinite] - whether to query into all sub-directories (defaults to &#x60;true&#x60;)
       * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_94821 directory-query}
       */
      directory: function directory() {
        var args = asArray.apply(null, arguments);
        var last = args[args.length - 1];
        var infinite = true;

        if ( last === true || last === false ) {
          infinite = last;
          args.pop();
        }

        // horrible hack to support an array of URIs
        if ( args.length === 1 &amp;amp;&amp;amp; Array.isArray(args[0]) ) {
          args = args[0];
        }

        return {
          &#x27;directory-query&#x27;: {
            &#x27;uri&#x27;: args,
            &#x27;infinite&#x27;: infinite
          }
        };
      },

      /**
       * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_27172 &#x60;document-query&#x60;}
       * @method MLQueryBuilder#document
       * @see http://docs.marklogic.com/jsdoc/queryBuilder.html#document
       *
       * @param {...String} uris - document URIs to match
       * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_27172 document-query}
       */
      document: function document() {
        var args = asArray.apply(null, arguments);
        return {
          &#x27;document-query&#x27;: {
            &#x27;uri&#x27;: args
          }
        };
      },

      /**
       * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_25949 &#x60;boost-query&#x60;}
       * @method MLQueryBuilder#boost
       * @see http://docs.marklogic.com/jsdoc/queryBuilder.html#boost
       *
       * @param {Object} matching - matching query
       * @param {Object} boosting - boosting query
       * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_25949 boost-query}
       */
      boost: function boost(matching, boosting) {
        return {
          &#x27;boost-query&#x27;: {
            &#x27;matching-query&#x27;: matching,
            &#x27;boosting-query&#x27;: boosting
          }
        };
      },

      /**
       * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_56027 &#x60;term-query&#x60;}
       * @method MLQueryBuilder#term
       * @see http://docs.marklogic.com/jsdoc/queryBuilder.html#term
       *
       * @param {...String} terms - terms to match (logical OR)
       * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_56027 term-query}
       */
      term: function term() {
        var args = asArray.apply(null, arguments);
        return {
          &#x27;term-query&#x27;: {
            &#x27;text&#x27;: args
          }
        };
      },

      /**
       * @method MLQueryBuilder#range
       * @see MLQueryBuilder.ext.rangeConstraint
       * @deprecated
       */
      range: function range(name, values) {
        console.log(
          &#x27;Warning, MLQueryBuilder.range is deprecated, and will be removed in the next release!\n&#x27; +
          &#x27;Use MLQueryBuilder.ext.rangeConstraint in it\&#x27;s place&#x27;
        );
        return this.ext.rangeConstraint.apply(this.ext, arguments);
      },

      /**
       * @method MLQueryBuilder#collection
       * @see MLQueryBuilder.ext.collectionConstraint
       * @deprecated
       */
      collection: function collection(name, values) {
        console.log(
          &#x27;Warning, MLQueryBuilder.collection is deprecated, and will be removed in the next release!\n&#x27; +
          &#x27;Use MLQueryBuilder.ext.collectionConstraint in it\&#x27;s place&#x27;
        );
        return this.ext.collectionConstraint.apply(this.ext, arguments);
      },

      /**
       * @method MLQueryBuilder#custom
       * @see MLQueryBuilder.ext.customConstraint
       * @deprecated
       */
      custom: function custom(name, values) {
        console.log(
          &#x27;Warning, MLQueryBuilder.custom is deprecated, and will be removed in the next release!\n&#x27; +
          &#x27;Use MLQueryBuilder.ext.customConstraint in it\&#x27;s place&#x27;
        );
        return this.ext.customConstraint.apply(this.ext, arguments);
      },

      /**
       * @method MLQueryBuilder#constraint
       * @see MLQueryBuilder.ext.constraint
       * @deprecated
       */
      constraint: function constraint(type) {
        console.log(
          &#x27;Warning, MLQueryBuilder.constraint is deprecated, and will be removed in the next release!\n&#x27; +
          &#x27;Use MLQueryBuilder.ext.constraint in it\&#x27;s place&#x27;
        );
        return this.ext.constraint.apply(this.ext, arguments);
      },

      /**
       * @method MLQueryBuilder#operator
       * @see MLQueryBuilder.ext.operator
       * @deprecated
       */
      operator: function operator(name, stateName) {
        console.log(
          &#x27;Warning, MLQueryBuilder.operator is deprecated, and will be removed in the next release!\n&#x27; +
          &#x27;Use MLQueryBuilder.ext.operator in it\&#x27;s place&#x27;
        );
        return this.ext.operatorState.apply(this.ext, arguments);
      },

      /**
       * query builder extensions
       * @memberof MLQueryBuilder
       * @type {Object}
       */
      ext: {

        /**
         * Builds a {@link http://docs.marklogic.com/guide/rest-dev/search#id_69918 combined query}
         * @memberof! MLQueryBuilder
         * @method ext.combined
         *
         * @param {Object} query - a structured query (from {@link MLQueryBuilder#where})
         * @param {String} [qtext] - a query text string, to be parsed server-side
         * @param {Object} [options] - search options
         * @return {Object} {@link http://docs.marklogic.com/guide/rest-dev/search#id_69918 combined query}
         */
        combined: function combined(query, qtext, options) {
          if ( isObject(qtext) &amp;amp;&amp;amp; !options ) {
            options = qtext;
            qtext = null;
          }

          return {
            search: {
              query: query &amp;amp;&amp;amp; query.query || query,
              qtext: qtext,
              options: options &amp;amp;&amp;amp; options.options || options
            }
          };
        },

        /**
         * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_38268 &#x60;range-constraint-query&#x60;}
         * @memberof! MLQueryBuilder
         * @method ext.rangeConstraint
         *
         * @param {String} name - constraint name
         * @param {String} [operator] - operator for matching constraint to &#x60;values&#x60;; one of &#x60;LT&#x60;, &#x60;LE&#x60;, &#x60;GT&#x60;, &#x60;GE&#x60;, &#x60;EQ&#x60;, &#x60;NE&#x60; (defaults to &#x60;EQ&#x60;)
         * @param {String|Array&amp;lt;String&gt;} values - the values the constraint should equal (logical OR)
         * @param {String|Array&amp;lt;String&gt;} [options] - range options: {@link http://docs.marklogic.com/guide/rest-dev/appendixa#id_84264}
         * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_38268 range-constraint-query}
         */
        rangeConstraint: function rangeConstraint(name, operator, values, options) {
          if ( !values &amp;amp;&amp;amp; !options ) {
            values = operator;
            operator = null;
          }

          if ( operator &amp;amp;&amp;amp; [&#x27;LT&#x27;, &#x27;LE&#x27;, &#x27;GT&#x27;, &#x27;GE&#x27;, &#x27;EQ&#x27;, &#x27;NE&#x27;].indexOf(operator) === -1 ) {
            throw new Error(&#x27;invalid rangeConstraint query operator: &#x27; + operator);
          }

          return {
            &#x27;range-constraint-query&#x27;: {
              &#x27;constraint-name&#x27;: name,
              &#x27;range-operator&#x27;: operator || &#x27;EQ&#x27;,
              &#x27;value&#x27;: asArray(values),
              &#x27;range-option&#x27;: asArray(options)
            }
          };
        },

        /**
         * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_63420 &#x60;value-constraint-query&#x60;}
         * @memberof! MLQueryBuilder
         * @method ext.valueConstraint
         *
         * @param {String} name - constraint name
         * @param {String|Number|Array&amp;lt;String&gt;|Array&amp;lt;Number&gt;|null} values - the values the constraint should equal (logical OR)
         * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_63420 value-constraint-query}
         */
        valueConstraint: function valueConstraint(name, values) {
          var query = {
            &#x27;value-constraint-query&#x27;: {
              &#x27;constraint-name&#x27;: name
            }
          };

          var type;

          if (values === null) {
            type = &#x27;null&#x27;;
            values = [];
          } else {
            values = asArray(values);
            type = typeof values[0];
            type = ((type === &#x27;string&#x27;) &amp;amp;&amp;amp; &#x27;text&#x27;) || type;
          }

          query[&#x27;value-constraint-query&#x27;][type] = values;

          return query;
        },

        /**
         * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_66833 &#x60;word-constraint-query&#x60;}
         * @memberof! MLQueryBuilder
         * @method ext.wordConstraint
         *
         * @param {String} name - constraint name
         * @param {String|Array&amp;lt;String&gt;} values - the values the constraint should equal (logical OR)
         * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_66833 word-constraint-query}
         */
        wordConstraint: function wordConstraint(name, values) {
          return {
            &#x27;word-constraint-query&#x27;: {
              &#x27;constraint-name&#x27;: name,
              &#x27;text&#x27;: asArray(values)
            }
          };
        },

        /**
         * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_30776 &#x60;collection-constraint-query&#x60;}
         * @memberof! MLQueryBuilder
         * @method ext.collectionConstraint
         *
         * @param {String} name - constraint name
         * @param {String|Array&amp;lt;String&gt;} values - the values the constraint should equal (logical OR)
         * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_30776 collection-constraint-query}
         */
        collectionConstraint: function collectionConstraint(name, values) {
          return {
            &#x27;collection-constraint-query&#x27;: {
              &#x27;constraint-name&#x27;: name,
              &#x27;uri&#x27;: asArray(values)
            }
          };
        },

        /**
         * Builds a {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_28778 &#x60;custom-constraint-query&#x60;}
         * @memberof! MLQueryBuilder
         * @method ext.customConstraint
         *
         * @param {String} name - constraint name
         * @param {String|Array&amp;lt;String&gt;} values - the values the constraint should equal (logical OR)
         * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_28778 custom-constraint-query}
         */
        customConstraint: function customConstraint(name, values) {
          return {
            &#x27;custom-constraint-query&#x27;: {
              &#x27;constraint-name&#x27;: name,
              &#x27;value&#x27;: asArray(values)
            }
          };
        },

        /**
         * constraint query function factory
         * @memberof! MLQueryBuilder
         * @method ext.constraint
         *
         * @param {String} type - constraint type (&#x60;&#x27;value&#x27; || &#x27;word&#x27; || collection&#x27; || &#x27;custom&#x27; || &#x27;*&#x27;&#x60;)
         * @return {Function} a constraint query builder function, one of:
         *   - {@link MLQueryBuilder.ext.rangeConstraint}
         *   - {@link MLQueryBuilder.ext.valueConstraint}
         *   - {@link MLQueryBuilder.ext.wordConstraint}
         *   - {@link MLQueryBuilder.ext.collectionConstraint}
         *   - {@link MLQueryBuilder.ext.customConstraint}
         */
        constraint: function constraint(type) {
          switch(type) {
            case &#x27;value&#x27;:
              return this.valueConstraint;
            case &#x27;word&#x27;:
              return this.wordConstraint;
            case &#x27;custom&#x27;:
              return this.customConstraint;
            case &#x27;collection&#x27;:
              return this.collectionConstraint;
            default:
              return this.rangeConstraint;
          }
        },

        /**
         * Builds an {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_45570 &#x60;operator-state&#x60; query component}
         * @memberof! MLQueryBuilder
         * @method ext.operatorState
         *
         * @param {String} name - operator name
         * @param {String} stateName - operator-state name
         * @return {Object} {@link http://docs.marklogic.com/guide/search-dev/structured-query#id_45570 operator-state query component}
         */
        operatorState: function operatorState(name, stateName) {
          return {
            &#x27;operator-state&#x27;: {
              &#x27;operator-name&#x27;: name,
              &#x27;state-name&#x27;: stateName
            }
          };
        }
      }

    };

  }

  function asArray() {
    var args;

    if ( arguments.length === 1) {
      if (Array.isArray( arguments[0] )) {
        args = arguments[0];
      } else {
        args = [ arguments[0] ];
      }
    } else {
      args = [].slice.call(arguments);
    }

    return args;
  }

  // from lodash
  function isObject(value) {
    var type = typeof value;
    return !!value &amp;amp;&amp;amp; (type === &#x27;object&#x27; || type === &#x27;function&#x27;);
  }

}());
</code></pre>
          </article>
        </div>
      </div>
      <nav id="jsdoc-toc-nav" role="navigation"></nav>
    </div>
  </div>
  <footer id="jsdoc-footer" class="jsdoc-footer">
    <div id="jsdoc-footer-container">
      <p>
        Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc</a> 3.3.2 on September 22, 2015.
      </p>
    </div>
  </footer>
  <script src="scripts/jquery.min.js"></script>
  <script src="scripts/jquery.cookie.js"></script>
  <script src="scripts/tree.jquery.js"></script>
  <script src="scripts/prettify.js"></script>
  <script src="scripts/jsdoc-toc.js"></script>
  <script src="scripts/linenumber.js"></script>
  <script src="scripts/scrollanchor.js"></script>
</body>

</html>